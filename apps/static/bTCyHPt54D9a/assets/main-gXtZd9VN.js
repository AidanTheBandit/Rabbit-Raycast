(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();class g{constructor(i){this.canvas=i,this.ctx=i.getContext("2d"),this.width=240,this.height=320,this.canvas.width=this.width,this.canvas.height=this.height,this.player={x:5,y:5,angle:0,health:100,ammo:50},this.keys={},this.touching={},this.fov=Math.PI/3,this.rayCount=120,this.maxDepth=20,this.moveSpeed=.1,this.turnSpeed=.05,this.map=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,0,0,1,1,0,0,1,1,0,0,1],[1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,1],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],[1,0,1,0,0,1,0,0,0,0,1,0,0,1,0,1],[1,0,1,1,0,0,0,1,1,0,0,0,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1],[1,0,0,0,1,0,0,1,1,0,0,1,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],this.mapWidth=this.map[0].length,this.mapHeight=this.map.length,this.lastTime=0,this.targetFPS=30,this.frameInterval=1e3/this.targetFPS,this.running=!1,this.shooting=!1,this.muzzleFlash=0}castRay(i){const o=Math.sin(i),s=Math.cos(i);let e=this.player.x,n=this.player.y;for(let a=0;a<this.maxDepth;a+=.1){const l=Math.floor(e),r=Math.floor(n);if(l<0||l>=this.mapWidth||r<0||r>=this.mapHeight||this.map[r][l]===1)return a;e+=s*.1,n+=o*.1}return this.maxDepth}render(){this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#333",this.ctx.fillRect(0,0,this.width,this.height/2),this.ctx.fillStyle="#666",this.ctx.fillRect(0,this.height/2,this.width,this.height/2);for(let i=0;i<this.rayCount;i++){const o=this.player.angle-this.fov/2+i/this.rayCount*this.fov,s=this.castRay(o),e=this.height/2/s,n=this.height/2-e,a=this.height/2+e,l=Math.max(0,1-s/this.maxDepth),r=Math.floor(255*l);this.ctx.fillStyle=`rgb(${r}, ${Math.floor(r*.5)}, 0)`,this.ctx.fillRect(i/this.rayCount*this.width,n,this.width/this.rayCount+1,a-n)}this.muzzleFlash>0&&(this.ctx.fillStyle=`rgba(255, 255, 0, ${this.muzzleFlash})`,this.ctx.fillRect(0,0,this.width,this.height),this.muzzleFlash-=.1),this.ctx.strokeStyle="#FE5F00",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(this.width/2-10,this.height/2),this.ctx.lineTo(this.width/2+10,this.height/2),this.ctx.moveTo(this.width/2,this.height/2-10),this.ctx.lineTo(this.width/2,this.height/2+10),this.ctx.stroke()}update(i){const o=i/16.67;if(this.keys.up||this.touching.up){const s=this.player.x+Math.cos(this.player.angle)*this.moveSpeed*o,e=this.player.y+Math.sin(this.player.angle)*this.moveSpeed*o;this.isValidPosition(s,e)&&(this.player.x=s,this.player.y=e)}if(this.keys.down||this.touching.down){const s=this.player.x-Math.cos(this.player.angle)*this.moveSpeed*o,e=this.player.y-Math.sin(this.player.angle)*this.moveSpeed*o;this.isValidPosition(s,e)&&(this.player.x=s,this.player.y=e)}if((this.keys.left||this.touching.left)&&(this.player.angle-=this.turnSpeed*o),(this.keys.right||this.touching.right)&&(this.player.angle+=this.turnSpeed*o),this.keys.strafe||this.touching.strafe){const s=this.player.angle+Math.PI/2,e=this.player.x+Math.cos(s)*this.moveSpeed*o,n=this.player.y+Math.sin(s)*this.moveSpeed*o;this.isValidPosition(e,n)&&(this.player.x=e,this.player.y=n)}}isValidPosition(i,o){const s=Math.floor(i),e=Math.floor(o);return s<0||s>=this.mapWidth||e<0||e>=this.mapHeight?!1:this.map[e][s]===0}shoot(){this.player.ammo>0&&(this.player.ammo--,this.muzzleFlash=.5,this.shooting=!0,document.getElementById("ammoValue").textContent=this.player.ammo,setTimeout(()=>{this.shooting=!1},100))}gameLoop(i){if(!this.running)return;const o=i-this.lastTime;o>=this.frameInterval&&(this.update(o),this.render(),this.lastTime=i),requestAnimationFrame(s=>this.gameLoop(s))}start(){this.running=!0,this.lastTime=performance.now(),this.gameLoop(this.lastTime)}stop(){this.running=!1}}let t,c="portrait";console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Doom Engine":"Running in browser mode - Doom Engine");function d(){const h=window.innerWidth>window.innerHeight?"landscape":"portrait";h!==c&&(c=h,console.log(`Orientation changed to: ${c}`),t&&(c==="landscape"?(t.width=320,t.height=240):(t.width=240,t.height=320),t.canvas.width=t.width,t.canvas.height=t.height,t.rayCount=c==="landscape"?160:120))}window.addEventListener("scrollUp",()=>{t&&(t.player.angle-=t.turnSpeed*2)});window.addEventListener("scrollDown",()=>{t&&(t.player.angle+=t.turnSpeed*2)});window.addEventListener("sideClick",()=>{t&&t.shoot()});function u(){const h={up:document.getElementById("up"),down:document.getElementById("down"),left:document.getElementById("left"),right:document.getElementById("right"),shoot:document.getElementById("shoot"),use:document.getElementById("use"),strafe:document.getElementById("strafe")};Object.entries(h).forEach(([i,o])=>{o&&(o.addEventListener("touchstart",s=>{s.preventDefault(),t.touching[i]=!0,i==="shoot"&&t.shoot()}),o.addEventListener("touchend",s=>{s.preventDefault(),t.touching[i]=!1}),o.addEventListener("mousedown",s=>{s.preventDefault(),t.touching[i]=!0,i==="shoot"&&t.shoot()}),o.addEventListener("mouseup",s=>{s.preventDefault(),t.touching[i]=!1}))})}window.addEventListener("keydown",h=>{if(t)switch(h.code){case"ArrowUp":case"KeyW":t.keys.up=!0;break;case"ArrowDown":case"KeyS":t.keys.down=!0;break;case"ArrowLeft":case"KeyA":t.keys.left=!0;break;case"ArrowRight":case"KeyD":t.keys.right=!0;break;case"Space":h.preventDefault(),t.shoot();break;case"ShiftLeft":t.keys.strafe=!0;break}});window.addEventListener("keyup",h=>{if(t)switch(h.code){case"ArrowUp":case"KeyW":t.keys.up=!1;break;case"ArrowDown":case"KeyS":t.keys.down=!1;break;case"ArrowLeft":case"KeyA":t.keys.left=!1;break;case"ArrowRight":case"KeyD":t.keys.right=!1;break;case"ShiftLeft":t.keys.strafe=!1;break}});document.addEventListener("DOMContentLoaded",()=>{console.log("R1 Doom initializing...");const h=document.getElementById("gameCanvas"),i=document.getElementById("loading");d(),window.addEventListener("resize",d),window.addEventListener("orientationchange",()=>{setTimeout(d,100)}),t=new g(h),u(),setTimeout(()=>{i.classList.add("hidden"),t.start(),console.log("R1 Doom started!")},1e3),document.getElementById("healthValue").textContent=t.player.health,document.getElementById("ammoValue").textContent=t.player.ammo});window.onPluginMessage=function(h){console.log("Doom received message:",h),h.message&&console.log("Game message:",h.message)};console.log("R1 Doom Engine Ready!");console.log("Controls:");console.log("- Scroll wheel: Turn left/right");console.log("- Side button: Shoot");console.log("- Touch controls: Movement and actions");console.log("- Orientation: Auto-detect portrait/landscape");
